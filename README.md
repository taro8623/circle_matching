# 🎵 Circle Matching（仮）

大学サークル向けの **曲募集・パートマッチング・チャット** を一体化した Web アプリです。  
バンド・アカペラ・軽音など、複数パートで構成されるサークル活動を効率化するために設計しています。

---

## 🎤 アプリ概要

### 🔐 1. ログイン・サークル登録

- サークル ID ＋サークル登録パスワードで新規ユーザ登録
- ログイン ID ＋パスワードでログイン
- 将来的には複数大学・複数サークル対応予定

---

### 🏠 2. ホーム画面（おすすめ曲）

- 自分の担当パートが募集中の曲を一覧表示
- Tinder 風カード UI で「興味あり／スキップ」も可能
- 曲の募集状況をひと目で確認できる

---

### 🎼 3. 曲起票（曲の新規作成）

- 曲名、アーティスト名を入力
- パートごとに以下を設定
  - 募集中
  - 不要
  - 自分で担当
  - 他ユーザを指定
- パートはプルダウンから自由に追加可能

---

### 📄 4. 曲詳細ページ

- 各パートの募集状況を表示
- 立候補者一覧
- 起案者は採用者を選択可能
- 採用後は自動でチャットルームが生成される

---

### 💬 5. チャット画面（WebSocket）

- 曲ごとのチャットルーム
- メンバー確定後に自動生成
- FastAPI WebSocket × React でリアルタイム通信

---

## 🚀 開発ロードマップ

### **STEP 1：ローカルで最小機能を作る（MVP）**

- FastAPI で API 作成
- React（Vite）でログイン＋曲一覧
- ローカル PostgreSQL
- 「曲起票 → 募集 → 立候補 → 採用」の一連の流れを完成

---

### **STEP 2：リアルタイムチャット追加**

- FastAPI WebSocket
- React でチャット UI
- 曲ごとにチャットルームを生成

---

### **STEP 3：Azure に手動デプロイ**

- Azure VM 作成
- Nginx 設定
- FastAPI + React を本番環境で動作
- PostgreSQL も Azure 上に移行

---

### **STEP 4：Ansible で自動化**

- VM のセットアップを自動化
- Git pull → React ビルド → FastAPI 起動
- systemd でサービス化
- Nginx 設定も自動化

---

### **STEP 5：複数大学対応**

- サークルごとにデータ分離
- サークル管理画面
- パート自由追加
- 大規模運用に向けたチューニング

---

## 🛠️ 技術スタック

### **Backend**

- FastAPI
- PostgreSQL
- SQLAlchemy
- JWT 認証
- WebSocket（リアルタイムチャット）

### **Frontend**

- React（Vite）
- TypeScript
- Zustand or Redux（状態管理予定）

### **Infrastructure**

- Azure VM
- Nginx
- Ansible（自動構築）
- systemd（サービス管理）

---

---

## 📄 ライセンス

MIT License（予定）

## 🚀 認証機能の実装進捗

## ✅ 完了済みタスク

### 🎨 フロントエンド（UI）

- ユーザー登録画面（Signup UI）
- ログイン画面（Login UI）
- Me ページ（ログイン確認用 UI）

### 🧩 バックエンド（API / 認証ロジック）

- ユーザー登録 API（bcrypt ハッシュ化、DB 保存）
- ログイン API（bcrypt 検証、JWT 発行）
- JWT 認証基盤（create_access_token / get_current_user）
- `/me` 認証必須 API

### 🔐 認証フロー（フロント × バック連携）

- ログイン成功後に /me へ遷移
- トークン保存（localStorage）
- 認証付きページの基礎（Me.tsx）

---

### 🔧 進行中 / 改善予定のタスク

ログイン後に自動で /me や /songs に移動する
ログインしていない人は /login に戻す（保護ルート）
曲一覧ページ（/songs）を作り始める
曲起票 → 募集 → 立候補 → 採用の流れを作る

- **SECRET_KEY を .env に移動（セキュリティ強化）**
- **Signup 時の email 重複チェック追加**
- **エラーレスポンスの統一（401 / 404 / 400）**
- **認証ロジックのファイル分割（routers / services / schemas）**
- **フロント側でのトークン保存（localStorage or Cookie）**
- **認証付き API のフロント実装**

---

### 📝 今後の予定

/me ページでユーザー情報を正しく表示できるようにする
未ログイン時に /login に戻す認証ガードを作る
ログアウト機能を追加する

- **リフレッシュトークン導入の検討**
  - 保存場所（DB / Redis / Cookie）
  - ローテーション方式の採用可否
- **チーム開発向けのコード構造整備**
  - controllers / services / repositories の分離
  - エラーハンドリングの共通化
  - env スキーマ化（pydantic Settings など）
- **テスト環境の整備**
  - ユニットテスト
  - E2E テスト
